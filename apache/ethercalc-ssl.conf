<VirtualHost *:443>
    ServerName sheets.example.com

    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/sheets.example.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/sheets.example.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    ProxyPreserveHost On
    ProxyRequests Off

    <Proxy *>
        Require all granted
    </Proxy>

    # Basic authentication
    <Location />
        AuthType Basic
        AuthName "EtherCalc"
        AuthBasicProvider file
        AuthUserFile /etc/apache2/ethercalc-users
        Require valid-user
    </Location>

    # HTTP proxy
    ProxyPass / http://127.0.0.1:8083/
    ProxyPassReverse / http://127.0.0.1:8083/

    # WebSocket support
    ProxyPass /zappa/socket/ ws://127.0.0.1:8083/zappa/socket/
    ProxyPassReverse /zappa/socket/ ws://127.0.0.1:8083/zappa/socket/

    RequestHeader set X-Forwarded-Proto "https"

    ErrorLog ${APACHE_LOG_DIR}/ethercalc_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/ethercalc_ssl_access.log combined
</VirtualHost>
